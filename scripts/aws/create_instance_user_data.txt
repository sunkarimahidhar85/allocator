#!/bin/bash

# Note:  user-data doesn't need to run as `sudo`:

# Install Minikube
export MINIKUBE_VERSION=0.24.1
curl -Lo minikube https://storage.googleapis.com/minikube/releases/v${MINIKUBE_VERSION}/minikube-linux-amd64
chmod a+x minikube
mv minikube /usr/local/bin/

# Install Kubectl
export KUBERNETES_VERSION=1.8.6
wget https://storage.googleapis.com/kubernetes-release/release/v${KUBERNETES_VERSION}/bin/linux/amd64/kubectl 
chmod a+x kubectl 
mv kubectl /usr/local/bin/kubectl

# TODO:  add -b r1.5 
git clone https://github.com/PipelineAI/notebooks.git
git clone https://github.com/PipelineAI/models.git

nvidia-docker run -itd --name pipelineai-notebook --env JUPYTERHUB_AUTHENTICATOR=dummyauthenticator.DummyAuthenticator --env AUTH0_SUBDOMAIN='' --env OAUTH_CALLBACK_URL='' --env OAUTH_CLIENT_ID='' --env OAUTH_CLIENT_SECRET='' --env GITHUB_OAUTH_CLIENT_ID='' --env GITHUB_OAUTH_CLIENT_SECRET='' -v ~/notebooks:/root/notebooks -v ~/models:/root/models -p 80:80 -p 50070:50070 -p 39000:39000 -p 9000:9000 -p 9001:9001 -p 9002:9002 -p 9003:9003 -p 9004:9004 -p 6006:6006 -p 8754:8754 -p 8755:8755 -p 7077:7077 -p 6066:6066 -p 6060:6060 -p 6061:6061 -p 4040:4040 -p 4041:4041 -p 4042:4042 -p 4043:4043 -p 4044:4044 -p 2222:2222 -p 10254:10254 -p 5050:5050 -p 54321:54321 pipelineai/notebook-gpu:1.5.0
